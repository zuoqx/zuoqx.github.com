---
layout: post
title: Java Class文件结构
description: Java Class文件结构
category: blog
---


### 概述   
1. 越来越多的程序语言选择了与操作系统和机器指令集无关的、平台中立的格式作为程序编译后的存储格式   
2. 字节码（ByteCode）是构成平台无关性的基石   
3. 除Java语言之外，运行在Java虚拟机之上运行的语言还有，如Clojure、Groovy、JRuby、Jython、Scala   
4. 实现语言无关性的基础仍然是虚拟机和字节码存储格式。Java虚拟机不和包括Java在内
的任何语言绑定，它只与“Class文件”这种特定的二进制文件格式所关联   
### Class类文件的结构   
任何一个Class文件都对应着唯一一个类或接口的定义信息，但反过来说，类或接
口并不一定都得定义在文件里（譬如类或接口也可以通过类加载器直接生成）   

        Class文件是一组以8位字节为基础单位的二进制流，排列紧凑，中间无任何分隔符   
        Class文件格式采用一种类似于C语言结构体的伪结构来存储数据，这种伪结构中只有两种数据类型：无符号数和表   
        无符号数可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成字符串值，以u1、u2、u4、u8来分别代表1个字节、2个字节、4个字节和8个字节的无符号数   
        表用于描述有层次关系的复合结构的数据，由多个无符号数或者其他表作为数据项构成的复合数据类型   
        当需要描述同一类型但数量不定的多个数据时，经常会使用该类型的集合来表示，集合的形式是一个前置的容量计数器加若干个连续的数据项的形式   
### 魔数与Class文件的版本   
1. 每个Class文件的头4个字节称为魔数（Magic Number），其值为OxCAFEBABE   
2. 魔数的唯一作用是确定这个文件是否为一个能被虚拟机接受的Class文件   
3. 紧接着魔数的4个字节存储的是Class文件的次版本号和主版本号   
4. 高版本的JDK能向下兼容以前版本的Class文件，但不能运行以后版本的Class文件   
### 常量池   
1. 常量池紧接着版本号之后，是Class文件中最大的表类型数据项   
2. 常量池中常量的数量不固定，在常量池的入口需要放置一项u2类型的数据，代表常量池容量计数值（constant_pool_count），但从1开始计数   
3. 常量池中主要存放两大类常量：字面量（Literal）和符号引用（Symbolic References）   

        字面量存放，文本字符串、声明为final的常量   

        符号引用则存放，类和接口的全限定名、字段的名称和描述符、方法的名称和描述符   

4. 在Class文件中不会保存各个方法、字段的最终内存布局信息，当虚拟机运行时，需要从常量池获得对应的符号引用，再在类创建时或运行时解析、翻译到具体的内存地址之中   
5. 常量池中每一项常量都是一个表，共14种表，均有自己的表结构，但表开始的第一位是一个u1类型的标志位，代表当前这个常量属于哪种常量类型   
### 访问标志   
1. 访问标志（access_flags）紧接着常量池结束之后，用两个字节代表
2. 访问标志，用于识别一些类或者接口层次的访问信息，包括：   
        这个Class是类还是接口；   
        是否定义为public类型；   
        是否定义为abstract类型；   
        如果是类的话，是否被声明为final等   

### 类索引、父类索引与接口索引集合   


