---
layout: post
title: Activity 任务和启动模式
description: Activity 任务和启动模式
category: blog
---


### 任务

任务是指在执行特定作业时与用户交互的一系列Activity集合。这些Activity集合按照各自打开的顺序排列在堆栈（即“返回栈”或者”任务栈”）中。

1. 当一个Activity启动另一个Activity时，新启动的Activity会被压入栈顶，成为焦点Activity。而前一个Activity仍留在堆栈中，但出于停止状态（onStop()状态）。
2. 用户按“返回”键时，当前Activity从堆栈顶部弹出（Activity被销毁），而前一个Activity则恢复执行。
3. 返回栈（任务栈）是以“后进先出”栈的数据结构运行，因此栈内的顺序不会重排列。
4. 当所有的Activity从任务中删除后，任务也将不存在了。
5. 当开始新任务或者按Home键回到Home页时，任务将被移到“后台”，失去焦点。里面的所有Activity全部停止，但该任务的返回栈仍旧不变。
6. 后台可以同时运行多个任务，但如果系统内存不足时，系统会销毁后台的Activity，以回收内存资源，从而导致Activity状态丢失。
7. 无论是在同一个任务内，还是来自其他多个任务，一个Activity也可以被多次实例化。

### 保存Activity状态

当Activity被销毁且必须重新创建时，需要用户主动保存Activity的状态：

1. 处于后台的Activity被系统回收时，Activity的状态信息将会丢失
2. 处于任务栈内的Activity，系统会保留状态，但出栈后，Activity会被销毁，应该保存状态
3. 调用`onSaveInstanceState() `回调方法保存状态

### 管理任务

1. 默认系统管理任务和返回栈的方式非常适用于大多数应用，没有必要特意管理这些
2. 通过使用`<activity>` manifest文件中的属性，和传递给`startActivity()`的Intent中的标志（Flags），可以管理Activity任务和相互之间的关联关系
3. 

